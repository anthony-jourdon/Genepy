

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Example: Two phases model, extension followed by compression &mdash; Genepy 1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=56dcb7b8"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Arbitrary Lagrangian Eulerian (ALE) model" href="ale_model.html" />
    <link rel="prev" title="Example: strike-slip model, rotated velocity field and mesh refinement" href="strikeslip_model.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Genepy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../usage.html">Usage</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../usage.html#installation">Installation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../usage.html#building-a-model">Building a model</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../gmsh_tuto.html">Building a mesh with Gmsh for the initial geometry and boundary conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="simple_model.html">Example: simple model, linear viscous rheology</a></li>
<li class="toctree-l3"><a class="reference internal" href="oblique_model.html">Example: oblique model, non-linear rheology</a></li>
<li class="toctree-l3"><a class="reference internal" href="strikeslip_model.html">Example: strike-slip model, rotated velocity field and mesh refinement</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Example: Two phases model, extension followed by compression</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#create-a-domain">1. Create a domain</a></li>
<li class="toctree-l4"><a class="reference internal" href="#velocity-field">2. Velocity field</a></li>
<li class="toctree-l4"><a class="reference internal" href="#initial-conditions">3. Initial conditions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#boundary-conditions">4. Boundary conditions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#material-parameters">5. Material parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-the-model-and-generate-options">6. Create the model and generate options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ale_model.html">Arbitrary Lagrangian Eulerian (ALE) model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#run-ptatin3d">Run pTatin3d</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../genepy_docs.html">Module genepy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Genepy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../usage.html">Usage</a></li>
      <li class="breadcrumb-item active">Example: Two phases model, extension followed by compression</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/time_dependant_model.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="strikeslip_model.html" class="btn btn-neutral float-left" title="Example: strike-slip model, rotated velocity field and mesh refinement" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ale_model.html" class="btn btn-neutral float-right" title="Arbitrary Lagrangian Eulerian (ALE) model" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="example-two-phases-model-extension-followed-by-compression">
<h1>Example: Two phases model, extension followed by compression<a class="headerlink" href="#example-two-phases-model-extension-followed-by-compression" title="Link to this heading"></a></h1>
<p>This example shows how to build a model with 2 tectonic phases.
For the example we consider a model with a first phase of orthogonal extension followed by a second phase of oblique compression.
Following the same pattern, it is possible to have a first phase of compression followed by a second phase of extension.
However, the example only covers a model with <strong>two</strong> tectonic phases.
No API is currently available for more than two phases but it is theoretically possible.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example shows a case where the direction of extension and compression are different.
In the case they are the same, it is not required to produce one options file per phase.</p>
</div>
<a class="reference internal image-reference" href="../_images/Inversion_1D-01.png"><img alt="../_images/Inversion_1D-01.png" src="../_images/Inversion_1D-01.png" style="width: 600px;" />
</a>
<a class="reference internal image-reference" href="../_images/velocity_inversion.gif"><img alt="../_images/velocity_inversion.gif" src="../_images/velocity_inversion.gif" style="width: 600px;" />
</a>
<section id="create-a-domain">
<h2>1. Create a domain<a class="headerlink" href="#create-a-domain" title="Link to this heading"></a></h2>
<p>We define a 3D <a class="reference internal" href="../initial_conditions.html#genepy.Domain" title="genepy.Domain"><code class="xref py py-class docutils literal notranslate"><span class="pre">Domain</span></code></a> <span class="math notranslate nohighlight">\(\Omega = [0,600]\times[-250,0]\times[0,300]\)</span> km<sup>3</sup>
<span class="math notranslate nohighlight">\(\in \mathbb R^3\)</span> discretized by a regular grid of 9x9x9 nodes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">genepy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gp</span>

<span class="c1"># 3D domain</span>
<span class="n">dimensions</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">O</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">250e3</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># Origin</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">600e3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">300e3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># Length</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span>         <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>   <span class="c1"># Number of Q1 nodes i.e. elements + 1</span>
<span class="c1"># Create Domain class instance</span>
<span class="n">Domain</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span><span class="n">dimensions</span><span class="p">,</span><span class="n">O</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="velocity-field">
<h2>2. Velocity field<a class="headerlink" href="#velocity-field" title="Link to this heading"></a></h2>
<p>We define two velocity fields, one for the extension phase and one for the compression phase.</p>
<section id="extension-phase">
<h3>2.1. Extension phase<a class="headerlink" href="#extension-phase" title="Link to this heading"></a></h3>
<p>The extension velocity field is defined as a orthogonal extension of 1 cm.a<sup>-1</sup> in the <span class="math notranslate nohighlight">\(x\)</span> direction.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">u_params</span>  <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;u_norm&quot;</span>        <span class="p">:</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">cma2ms</span><span class="p">,</span>     <span class="c1"># norm of the velocity on boundary</span>
             <span class="s2">&quot;variation_dir&quot;</span> <span class="p">:</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span>              <span class="c1"># direction in which velocity varies</span>
             <span class="s2">&quot;velocity_type&quot;</span> <span class="p">:</span> <span class="s2">&quot;extension&quot;</span><span class="p">,</span>      <span class="c1"># extension or compression (because norm &gt; 0)</span>
             <span class="s2">&quot;u_angle&quot;</span>       <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">90.0</span><span class="p">)</span>  <span class="c1"># angle of the velocity vector</span>
            <span class="p">}</span>
<span class="c1"># Create linear velocity class instance</span>
<span class="n">phase_1</span>   <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">VelocityLinear</span><span class="p">(</span><span class="n">Domain</span><span class="p">,</span><span class="o">**</span><span class="n">u_params</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="compression-phase">
<h3>2.2. Compression phase<a class="headerlink" href="#compression-phase" title="Link to this heading"></a></h3>
<p>The compression velocity field is defined as a 45 degrees compression of 3 cm.a<sup>-1</sup> in
the <span class="math notranslate nohighlight">\(x\)</span> direction.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">u_params</span>  <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;u_norm&quot;</span>        <span class="p">:</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">cma2ms</span><span class="p">,</span>     <span class="c1"># norm of the velocity on boundary</span>
             <span class="s2">&quot;variation_dir&quot;</span> <span class="p">:</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span>              <span class="c1"># direction in which velocity varies</span>
             <span class="s2">&quot;velocity_type&quot;</span> <span class="p">:</span> <span class="s2">&quot;compression&quot;</span><span class="p">,</span>    <span class="c1"># extension or compression (because norm &gt; 0)</span>
             <span class="s2">&quot;u_angle&quot;</span>       <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">45.0</span><span class="p">)</span>  <span class="c1"># angle of the velocity vector</span>
            <span class="p">}</span>
<span class="c1"># Create linear velocity class instance</span>
<span class="n">phase_2</span>   <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">VelocityLinear</span><span class="p">(</span><span class="n">Domain</span><span class="p">,</span><span class="o">**</span><span class="n">u_params</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="combine-the-two-phases">
<h3>2.3. Combine the two phases<a class="headerlink" href="#combine-the-two-phases" title="Link to this heading"></a></h3>
<p>First we define the time at which the tectonic phases change:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># time inversion parameters</span>
<span class="n">Ma2s</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3600.0</span> <span class="o">*</span> <span class="mf">24.0</span> <span class="o">*</span> <span class="mf">365.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="c1"># Million years to second conversion</span>
<span class="n">t1</span>   <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">Ma2s</span>
<span class="n">t2</span>   <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">Ma2s</span>
<span class="n">breakpoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="p">],</span>       <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># breakpoints in time (where atan(t-t0)=0 )</span>
<span class="n">slopes</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">5e-13</span><span class="p">,</span> <span class="mf">5e-13</span> <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># slope s of h(t) = s(t-t0) for atan(h(t)) function</span>
</pre></div>
</div>
<p>Then we combine the two velocity fields  and evaluate the time-dependant velocity
using the <a class="reference internal" href="../boundary_conditions.html#genepy.VelocityInversion" title="genepy.VelocityInversion"><code class="xref py py-class docutils literal notranslate"><span class="pre">VelocityInversion</span></code></a> class</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># create time dependant velocity inversion class instance</span>
<span class="n">bc_inv</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">VelocityInversion</span><span class="p">(</span><span class="n">Domain</span><span class="p">,</span><span class="n">phase_1</span><span class="p">,</span><span class="n">phase_2</span><span class="p">,</span><span class="n">breakpoints</span><span class="p">,</span><span class="n">slopes</span><span class="p">)</span>

<span class="c1"># Access the symbolic velocity function, its gradient and the orientation of the horizontal velocity at the boundary</span>
<span class="n">u</span>      <span class="o">=</span> <span class="n">bc_inv</span><span class="o">.</span><span class="n">u</span>                   <span class="c1"># velocity function</span>
<span class="n">grad_u</span> <span class="o">=</span> <span class="n">bc_inv</span><span class="o">.</span><span class="n">grad_u</span>              <span class="c1"># gradient of the velocity function</span>
<span class="n">uL_1</span>   <span class="o">=</span> <span class="n">bc_inv</span><span class="o">.</span><span class="n">u_dir_horizontal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># orientation of the extension phase</span>
<span class="n">uL_2</span>   <span class="o">=</span> <span class="n">bc_inv</span><span class="o">.</span><span class="n">u_dir_horizontal</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># orientation of the compression phase</span>
</pre></div>
</div>
<p>To help visualize the resulting time dependant velocity function a
<a class="reference internal" href="../boundary_conditions.html#genepy.VelocityInversion.plot_1D_velocity" title="genepy.VelocityInversion.plot_1D_velocity"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plotting</span> <span class="pre">method</span></code></a> using matplotlib is available:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the 1D velocity profile over time</span>
<span class="n">time_1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span> <span class="o">*</span> <span class="n">Ma2s</span> <span class="c1"># time array for plot</span>
<span class="n">bc_inv</span><span class="o">.</span><span class="n">plot_1D_velocity</span><span class="p">(</span><span class="n">time_1d</span><span class="p">)</span>
</pre></div>
</div>
<p>This function uses the norm of the velocity to plot the velocity profile over time.
The sign convention used is that the velocity is positive for extension and negative for compression.
In addition, if the velocity should pass through zero over time a red dot is added to the plot.
To obtain the time at which the velocity evaluates to zero you can use the
<a class="reference internal" href="../boundary_conditions.html#genepy.VelocityInversion.get_time_zero_velocity" title="genepy.VelocityInversion.get_time_zero_velocity"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_time_zero_velocity()</span></code></a> method and print the result:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># time at which velocity is 0 during the tectonic regime inversion</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">bc_inv</span><span class="o">.</span><span class="n">get_time_zero_velocity</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time at which velocity is 0: </span><span class="si">{</span><span class="n">t0</span><span class="o">/</span><span class="n">Ma2s</span><span class="si">}</span><span class="s2"> Myr&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="initial-conditions">
<h2>3. Initial conditions<a class="headerlink" href="#initial-conditions" title="Link to this heading"></a></h2>
<p>Gather the information defined previously to generate the options for the initial conditions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initial conditions</span>
<span class="n">model_ics</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">InitialConditions</span><span class="p">(</span><span class="n">Domain</span><span class="p">,</span><span class="n">u</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="boundary-conditions">
<h2>4. Boundary conditions<a class="headerlink" href="#boundary-conditions" title="Link to this heading"></a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In this example, the extension and compression do not follow the same orientation i.e.,
the extension is parallel to the <span class="math notranslate nohighlight">\(x\)</span> axis and the compression is at 45 degrees.
Therefore, the boundary conditions are defined for each phase separately and 2 options files
must be produced.
This is necessary because the type of boundary conditions change between the two phases.
In the case the orientation between the two phases does not change, their type can be the same and
only one options file is required.</p>
</div>
<section id="temperature-boundary-conditions">
<h3>4.1. Temperature boundary conditions<a class="headerlink" href="#temperature-boundary-conditions" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Tbcs</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">TemperatureBC</span><span class="p">({</span><span class="s2">&quot;ymax&quot;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;ymin&quot;</span><span class="p">:</span><span class="mf">1450.0</span><span class="p">})</span>
</pre></div>
</div>
</section>
<section id="id1">
<h3>4.2. Extension phase<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p>The extension phase is defined as an orthogonal extension, therefore we can define all BCs as
<a class="reference internal" href="../boundary_conditions.html#genepy.Dirichlet" title="genepy.Dirichlet"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dirichlet</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># path to mesh files (system dependent, change accordingly)</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PTATIN&#39;</span><span class="p">],</span><span class="s2">&quot;ptatin-gene/src/models/gene3d/examples&quot;</span><span class="p">)</span>
<span class="c1"># Velocity boundary conditions</span>
<span class="c1"># zmax parameters</span>
<span class="n">zmax</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tag&quot;</span>        <span class="p">:</span><span class="mi">23</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span>       <span class="p">:</span><span class="s2">&quot;Zmax&quot;</span><span class="p">,</span>
        <span class="s2">&quot;components&quot;</span> <span class="p">:[</span><span class="s2">&quot;z&quot;</span><span class="p">],</span>
        <span class="s2">&quot;velocity&quot;</span>   <span class="p">:</span><span class="n">u</span><span class="p">,</span>
        <span class="s2">&quot;mesh_file&quot;</span>  <span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="s2">&quot;box_ptatin_facet_23_mesh.bin&quot;</span><span class="p">)}</span>
<span class="c1"># Create Dirichlet boundary condition class instance for zmax face</span>
<span class="n">zmax_face</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Dirichlet</span><span class="p">(</span><span class="o">**</span><span class="n">zmax</span><span class="p">)</span>

<span class="c1"># zmin parameters</span>
<span class="n">zmin</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tag&quot;</span><span class="p">:</span><span class="mi">37</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Zmin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;components&quot;</span><span class="p">:[</span><span class="s2">&quot;z&quot;</span><span class="p">],</span>
        <span class="s2">&quot;velocity&quot;</span><span class="p">:</span><span class="n">u</span><span class="p">,</span>
        <span class="s2">&quot;mesh_file&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="s2">&quot;box_ptatin_facet_37_mesh.bin&quot;</span><span class="p">)}</span>
<span class="c1"># Create Dirichlet boundary condition class instance for zmin face</span>
<span class="n">zmin_face</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Dirichlet</span><span class="p">(</span><span class="o">**</span><span class="n">zmin</span><span class="p">)</span>

<span class="c1"># xmax parameters</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tag&quot;</span><span class="p">:</span><span class="mi">32</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Xmax&quot;</span><span class="p">,</span>
        <span class="s2">&quot;components&quot;</span><span class="p">:[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
        <span class="s2">&quot;velocity&quot;</span><span class="p">:</span><span class="n">u</span><span class="p">,</span>
        <span class="s2">&quot;mesh_file&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="s2">&quot;box_ptatin_facet_32_mesh.bin&quot;</span><span class="p">)}</span>
<span class="c1"># Create Navier slip boundary condition class instance for xmax face</span>
<span class="n">xmax_face</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Dirichlet</span><span class="p">(</span><span class="o">**</span><span class="n">xmax</span><span class="p">)</span>

<span class="c1"># xmin parameters</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tag&quot;</span><span class="p">:</span><span class="mi">14</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Xmin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;components&quot;</span><span class="p">:[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
        <span class="s2">&quot;velocity&quot;</span><span class="p">:</span><span class="n">u</span><span class="p">,</span>
        <span class="s2">&quot;mesh_file&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="s2">&quot;box_ptatin_facet_14_mesh.bin&quot;</span><span class="p">)}</span>
<span class="c1"># Create Navier slip boundary condition class instance for xmin face</span>
<span class="n">xmin_face</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Dirichlet</span><span class="p">(</span><span class="o">**</span><span class="n">xmin</span><span class="p">)</span>

<span class="c1"># bottom parameters</span>
<span class="n">bottom</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tag&quot;</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span>
          <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Bottom&quot;</span><span class="p">,</span>
          <span class="s2">&quot;mesh_file&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="s2">&quot;box_ptatin_facet_33_mesh.bin&quot;</span><span class="p">)}</span>
<span class="c1"># Create DirichletUdotN boundary condition class instance for bottom face</span>
<span class="n">bottom_face</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">DirichletUdotN</span><span class="p">(</span><span class="o">**</span><span class="n">bottom</span><span class="p">)</span>

<span class="c1"># collect stokes boundary conditions in a list</span>
<span class="n">bcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">zmax_face</span><span class="p">,</span><span class="n">zmin_face</span><span class="p">,</span><span class="n">xmax_face</span><span class="p">,</span><span class="n">xmin_face</span><span class="p">,</span><span class="n">bottom_face</span><span class="p">]</span>

<span class="c1"># collect all boundary conditions</span>
<span class="n">bc_phase_1</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">ModelBCs</span><span class="p">(</span><span class="n">bcs</span><span class="p">,</span><span class="n">Tbcs</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id2">
<h3>4.3. Compression phase<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<p>The compression phase is defined as a 45 degrees compression, therefore we need to define the boundary conditions
as a combination of <a class="reference internal" href="../boundary_conditions.html#genepy.Dirichlet" title="genepy.Dirichlet"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dirichlet</span></code></a> and <a class="reference internal" href="../boundary_conditions.html#genepy.NavierSlip" title="genepy.NavierSlip"><code class="xref py py-class docutils literal notranslate"><span class="pre">Navier-slip</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Velocity boundary conditions</span>
<span class="c1"># zmax parameters</span>
<span class="n">zmax</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tag&quot;</span>        <span class="p">:</span><span class="mi">23</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span>       <span class="p">:</span><span class="s2">&quot;Zmax&quot;</span><span class="p">,</span>
        <span class="s2">&quot;components&quot;</span> <span class="p">:[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;z&quot;</span><span class="p">],</span>
        <span class="s2">&quot;velocity&quot;</span>   <span class="p">:</span><span class="n">u</span><span class="p">,</span>
        <span class="s2">&quot;mesh_file&quot;</span>  <span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="s2">&quot;box_ptatin_facet_23_mesh.bin&quot;</span><span class="p">)}</span>
<span class="c1"># Create Dirichlet boundary condition class instance for zmax face</span>
<span class="n">zmax_face</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Dirichlet</span><span class="p">(</span><span class="o">**</span><span class="n">zmax</span><span class="p">)</span>

<span class="c1"># zmin parameters</span>
<span class="n">zmin</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tag&quot;</span><span class="p">:</span><span class="mi">37</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Zmin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;components&quot;</span><span class="p">:[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;z&quot;</span><span class="p">],</span>
        <span class="s2">&quot;velocity&quot;</span><span class="p">:</span><span class="n">u</span><span class="p">,</span>
        <span class="s2">&quot;mesh_file&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="s2">&quot;box_ptatin_facet_37_mesh.bin&quot;</span><span class="p">)}</span>
<span class="c1"># Create Dirichlet boundary condition class instance for zmin face</span>
<span class="n">zmin_face</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Dirichlet</span><span class="p">(</span><span class="o">**</span><span class="n">zmin</span><span class="p">)</span>

<span class="c1"># xmax parameters</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tag&quot;</span><span class="p">:</span><span class="mi">32</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Xmax&quot;</span><span class="p">,</span>
        <span class="s2">&quot;grad_u&quot;</span><span class="p">:</span><span class="n">grad_u</span><span class="p">,</span>
        <span class="s2">&quot;u_orientation&quot;</span><span class="p">:</span><span class="n">uL</span><span class="p">,</span>
        <span class="s2">&quot;mesh_file&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="s2">&quot;box_ptatin_facet_32_mesh.bin&quot;</span><span class="p">)}</span>
<span class="c1"># Create Navier slip boundary condition class instance for xmax face</span>
<span class="n">xmax_face</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">NavierSlip</span><span class="p">(</span><span class="o">**</span><span class="n">xmax</span><span class="p">)</span>

<span class="c1"># xmin parameters</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tag&quot;</span><span class="p">:</span><span class="mi">14</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Xmin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;grad_u&quot;</span><span class="p">:</span><span class="n">grad_u</span><span class="p">,</span>
        <span class="s2">&quot;u_orientation&quot;</span><span class="p">:</span><span class="n">uL</span><span class="p">,</span>
        <span class="s2">&quot;mesh_file&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="s2">&quot;box_ptatin_facet_14_mesh.bin&quot;</span><span class="p">)}</span>
<span class="c1"># Create Navier slip boundary condition class instance for xmin face</span>
<span class="n">xmin_face</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">NavierSlip</span><span class="p">(</span><span class="o">**</span><span class="n">xmin</span><span class="p">)</span>

<span class="c1"># bottom parameters</span>
<span class="n">bottom</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tag&quot;</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span>
          <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Bottom&quot;</span><span class="p">,</span>
          <span class="s2">&quot;mesh_file&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="s2">&quot;box_ptatin_facet_33_mesh.bin&quot;</span><span class="p">)}</span>
<span class="c1"># Create DirichletUdotN boundary condition class instance for bottom face</span>
<span class="n">bottom_face</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">DirichletUdotN</span><span class="p">(</span><span class="o">**</span><span class="n">bottom</span><span class="p">)</span>

<span class="c1"># collect stokes boundary conditions in a list</span>
<span class="n">bcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">zmax_face</span><span class="p">,</span><span class="n">zmin_face</span><span class="p">,</span><span class="n">xmax_face</span><span class="p">,</span><span class="n">xmin_face</span><span class="p">,</span><span class="n">bottom_face</span><span class="p">]</span>
<span class="c1"># collect all boundary conditions</span>
<span class="n">bc_phase_2</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">ModelBCs</span><span class="p">(</span><span class="n">bcs</span><span class="p">,</span><span class="n">Tbcs</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="material-parameters">
<h2>5. Material parameters<a class="headerlink" href="#material-parameters" title="Link to this heading"></a></h2>
<p>Next we define the material properties of each <a class="reference internal" href="../material_parameters.html#genepy.Region" title="genepy.Region"><code class="xref py py-class docutils literal notranslate"><span class="pre">Region</span></code></a> and
gather them all in a <a class="reference internal" href="../material_parameters.html#genepy.ModelRegions" title="genepy.ModelRegions"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelRegions</span></code></a> class instance.
To keep it simple we use the default parameters for all regions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># material parameters</span>
<span class="n">regions</span> <span class="o">=</span> <span class="p">[</span>
  <span class="c1"># Upper crust</span>
  <span class="n">gp</span><span class="o">.</span><span class="n">Region</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span><span class="n">energy</span><span class="o">=</span><span class="n">gp</span><span class="o">.</span><span class="n">Energy</span><span class="p">(</span><span class="n">conductivity</span><span class="o">=</span><span class="mf">3.3</span><span class="p">)),</span>
  <span class="c1"># Lower crust</span>
  <span class="n">gp</span><span class="o">.</span><span class="n">Region</span><span class="p">(</span><span class="mi">39</span><span class="p">,</span><span class="n">energy</span><span class="o">=</span><span class="n">gp</span><span class="o">.</span><span class="n">Energy</span><span class="p">(</span><span class="n">conductivity</span><span class="o">=</span><span class="mf">3.3</span><span class="p">)),</span>
  <span class="c1"># Lithosphere mantle</span>
  <span class="n">gp</span><span class="o">.</span><span class="n">Region</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span><span class="n">energy</span><span class="o">=</span><span class="n">gp</span><span class="o">.</span><span class="n">Energy</span><span class="p">(</span><span class="n">conductivity</span><span class="o">=</span><span class="mf">3.3</span><span class="p">)),</span>
  <span class="c1"># Asthenosphere</span>
  <span class="n">gp</span><span class="o">.</span><span class="n">Region</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span><span class="n">energy</span><span class="o">=</span><span class="n">gp</span><span class="o">.</span><span class="n">Energy</span><span class="p">(</span><span class="n">conductivity</span><span class="o">=</span><span class="mf">3.3</span><span class="p">))</span>
<span class="p">]</span>
<span class="c1"># path to mesh files (system dependent, change accordingly)</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PTATIN&#39;</span><span class="p">],</span><span class="s2">&quot;ptatin-gene/src/models/gene3d/examples&quot;</span><span class="p">)</span>
<span class="n">all_regions</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">ModelRegions</span><span class="p">(</span><span class="n">regions</span><span class="p">,</span>
                              <span class="n">mesh_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="s2">&quot;box_ptatin_md.bin&quot;</span><span class="p">),</span>
                              <span class="n">region_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="s2">&quot;box_ptatin_region_cell.bin&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="create-the-model-and-generate-options">
<h2>6. Create the model and generate options<a class="headerlink" href="#create-the-model-and-generate-options" title="Link to this heading"></a></h2>
<p>Finally, we create the <a class="reference internal" href="../model.html#genepy.Model" title="genepy.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">model</span></code></a> by gathering all the information defined previously.
However, because we have two tectonic phases, we need to produce two options files, one for each phase:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># write the options for ptatin3d</span>
<span class="n">model_phase_1</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">model_ics</span><span class="p">,</span><span class="n">all_regions</span><span class="p">,</span><span class="n">bc_phase_1</span><span class="p">)</span>
<span class="n">model_phase_2</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">model_ics</span><span class="p">,</span><span class="n">all_regions</span><span class="p">,</span><span class="n">bc_phase_2</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;model_phase_1.opts&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">model_phase_1</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;model_phase_2.opts&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">model_phase_2</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In practice, the two options files are run in sequence using the checkpointing capabilities of <a class="reference external" href="https://github.com/laetitialp/ptatin-gene">pTatin3d</a>.
The standard procedure should be:</p>
<ol class="arabic simple">
<li><p>Evaluate the time at which the velocity is zero using the <a class="reference internal" href="../boundary_conditions.html#genepy.VelocityInversion.get_time_zero_velocity" title="genepy.VelocityInversion.get_time_zero_velocity"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_time_zero_velocity()</span></code></a> method.</p></li>
<li><p>Run the first phase using the options file <code class="docutils literal notranslate"><span class="pre">model_phase_1.opts</span></code>.</p></li>
<li><p>When the time of the model reaches the time at which the velocity is zero, stop the simulation.</p></li>
<li><p>Run the second phase using the options file <code class="docutils literal notranslate"><span class="pre">model_phase_2.opts</span></code>.</p></li>
</ol>
<p><strong>If the first phase runs longer than the time at which the velocity is zero,
the checkpointing capability allows re-starting from any checkpointed time-step using the option</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">-restart_directory</span> <span class="pre">output_path/checkpoints/stepN</span></code> where <code class="docutils literal notranslate"><span class="pre">output_path</span></code> is the path to the model output directory,
and <code class="docutils literal notranslate"><span class="pre">N</span></code> is the number of the step from which you wish to restart and is located in the <code class="docutils literal notranslate"><span class="pre">checkpoints</span></code> subdirectory
inside the model output directory.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="strikeslip_model.html" class="btn btn-neutral float-left" title="Example: strike-slip model, rotated velocity field and mesh refinement" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ale_model.html" class="btn btn-neutral float-right" title="Arbitrary Lagrangian Eulerian (ALE) model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Anthony Jourdon.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>